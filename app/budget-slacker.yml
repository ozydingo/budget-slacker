imports:
- path: cloud_function.py
- path: handle_slack/index.js
- path: handle_slack/package.json
- path: budget_worker/budgets.js
- path: budget_worker/index.js
- path: budget_worker/package.json
- path: budget_worker/sheets.js
- path: budget_worker/slack.js
- path: budget_worker/spend.js

resources:
- name: slack-pubsub
  type: gcp-types/pubsub-v1:projects.topics
  properties:
    topic: slack-event
- name: budget-worker
  type: cloud_function.py
  properties:
    codeLocation: budget_worker
    codeBucket: budget-slacker-deploy
    codeBucketObject: budget_worker.zip
    location: us-east1
    timeout: 60s
    runtime: nodejs8
    trigger:
      eventTrigger: slack-pubsub
    pubsub_topic: slack-pubsub
    availableMemoryMb: 256
    entryPoint: main
- name: handle-slack
  type: cloud_function.py
  properties:
    codeLocation: handle_slack
    codeBucket: budget-slacker-deploy
    codeBucketObject: handle_slack.zip
    location: us-east1
    timeout: 60s
    runtime: nodejs8
    trigger:
      httpsTrigger: true
    availableMemoryMb: 256
    entryPoint: main
outputs:
- name: handle-slack-url
  value: $(ref.handle-slack.url)
- name: handle-slack-name
  value: $(ref.handle-slack.name)
- name: budget-worker-name
  value: $(ref.budget-worker.name)
